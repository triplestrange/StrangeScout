#!/bin/sh -e

domain="$(snapctl get domain)"
httponly="$(snapctl get httponly)"
port="$(snapctl get port)"

if [ -z "$domain" ]; then
	echo "domain is required"
	exit 1
fi

if [ -z "$port" ]; then
	echo "No port specified: defaulting to 80"
	port="80"
fi

if [ -z "$httponly" ]; then
	echo "httponly not specified: defaulting to false"
	port="false"
fi

printf "{\n" > $SNAP_COMMON/service.conf.json
printf "\"domain\": \"%s\",\n" "$domain" >> $SNAP_COMMON/service.conf.json
printf "\"httponly\": \"%s\",\n" "$httponly" >> $SNAP_COMMON/service.conf.json
printf "\"port\": \"%s\"\n" "$port" >> $SNAP_COMMON/service.conf.json
printf "}\n" >> $SNAP_COMMON/service.conf.json

snapctl restart
